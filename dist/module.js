define(["lodash","@grafana/data","@grafana/ui","rxjs","angular","app/core/utils/datemath","app/core/table_model","app/plugins/sdk"],function(e,t,r,n,s,o,i,a){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=10)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=s},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){ace.define("ace/mode/sumologic_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,r){"use strict";var n=e("../lib/oop"),s=e("./text_highlight_rules").TextHighlightRules,o=function(){var e=this.createKeywordMapper({"support.function":"abs|accum|acos|asin|atan|atan2|avg|backshift|cbrt|ceil|concat|cos|cosh|count|count_distinct|count_frequent|diff|exp|expm1|fields|fillmissing|filter|first|last|floor|format|formatDate|lookup|hypot|if|ipv4ToNumber|isNull|isEmpty|isBlank|join|length|limit|log|log10|log1p|luhn|num|number|toLong|pct|merge|max|min|most_recent|least_recent|now|outlier|csv|split|json|keyvalue|kv|xml|parseDate|parseHex|pct_sampling|predict|queryEndTime|queryStartTime|queryTimeRange|replace|rollingstd|round|save|sessionize|sin|sinh|smooth|sort|sqrt|stddev|substring|sum|tan|tanh|timeslice|toDegrees|toLowerCase|toUpperCase|top|toRadians|total|trace|transaction|transpose|urldecode|where|getCIDRPrefix|compareCIDRPrefix|maskFromCIDRlogreduce|details|compare|logcompare",keyword:"as|by|from|in|matches|nodrop|on|regex|with_collector|_index|_source|_sourceCategory|_sourceHost|_sourceName|_view","constant.language":"true|false"},"identifier",!0);this.$rules={start:[{token:"string",regex:/"(?:[^"\\]|\\.)*?"/},{token:"string",regex:"'.*?'"},{token:"constant.numeric",regex:"[-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language",regex:"\\d+[smh]"},{token:"constant.language",regex:"\\d+[kKMGBTP]"},{token:e,regex:"[a-zA-Z]+"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\/|%|=|==|!=|<=|>=|<>|<|>"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}]},this.normalizeRules()};n.inherits(o,s),t.SumologicHighlightRules=o}),ace.define("ace/mode/sumologic_completions",["require","exports","module","ace/token_iterator","ace/lib/lang"],function(e,t,r){"use strict";var n=e("../lib/lang"),s=["_collector","_index","_source","_sourceCategory","_sourceHost","_sourceName","_view","as","by","from","in","on","matches","regex","nodrop","with","abs","accum","acos","asin","atan","atan2","avg","backshift","cbrt","ceil","concat","cos","cosh","count","count_distinct","count_frequent","diff","exp","expm1","fields","fillmissing","filter","first","last","floor","format","formatDate","lookup","hypot","if","ipv4ToNumber","isNull","isEmpty","isBlank","join","length","limit","log","log10","log1p","luhn","num","number","toLong","pct","merge","max","min","most_recent","least_recent","now","outlier","csv","split","json","keyvalue","kv","xml","parseDate","parseHex","pct_sampling","predict","queryEndTime","queryStartTime","queryTimeRange","replace","rollingstd","round","save","sessionize","sin","sinh","smooth","sort","sqrt","stddev","substring","sum","tan","tanh","timeslice","toDegrees","toLowerCase","toUpperCase","top","toRadians","total","trace","transaction","transpose","urldecode","where","getCIDRPrefix","compareCIDRPrefix","maskFromCIDR","logreduce","details","compare","logcompare"].map(function(e){return{caption:e,value:e,meta:"keyword",score:Number.MAX_VALUE}});function o(e){var t=n.escapeHTML(e.docText);return t=function(e,t){for(var r=[],n=0,s=0,o=t=t||60,i="",a=0;a<e.length;a++)" "===e[a]?n=a:a>=o&&0!=n&&(i=e.slice(s,n),r.push(i),s=n+1,o=a+t,n=0);return i=e.slice(s),r.push(i),r.join("&nbsp<br>")}(t,40).replace(/```(.+)```/,"<pre>$1</pre>").replace(/`([^`]+)`/,"<code>$1</code>"),["<b>",n.escapeHTML(e.def),"</b>","<hr></hr>",t,"<br>&nbsp"].join("")}var i=[].map(function(e){return{caption:e.name,value:e.value,docHTML:o(e),meta:"function",score:Number.MAX_VALUE}}),a=function(){};(function(){this.getCompletions=function(e,t,r,n,o){o(null,s.concat(i))}}).call(a.prototype),t.SumologicCompletions=a}),ace.define("ace/mode/behaviour/sumologic",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/mode/behaviour/cstyle","ace/token_iterator"],function(e,t,r){"use strict";var n=e("../../lib/oop"),s=(e("../behaviour").Behaviour,e("./cstyle").CstyleBehaviour),o=(e("../../token_iterator").TokenIterator,function(){this.inherit(s)});n.inherits(o,s),t.SumologicBehaviour=o}),ace.define("ace/mode/sumologic",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/sumologic_highlight_rules"],function(e,t,r){"use strict";var n=e("../lib/oop"),s=e("./text").Mode,o=e("./sumologic_highlight_rules").SumologicHighlightRules,i=e("./sumologic_completions").SumologicCompletions,a=e("./behaviour/sumologic").SumologicBehaviour,u=function(){this.HighlightRules=o,this.$behaviour=new a,this.$completer=new i,this.completer=this.$completer};n.inherits(u,s),function(){this.$id="ace/mode/sumologic"}.call(u.prototype),t.Mode=u})},function(e,t){ace.define("ace/snippets/sumologic",["require","exports","module"],function(e,t,r){"use strict";t.snippets=[],t.scope="sumologic"})},function(e,t,r){"use strict";r.r(t);var n=r(0),s=r.n(n),o=r(5),i=r.n(o),a=r(6),u=r.n(a),c=r(3),l=function(e,t,r,n){return new(r||(r=Promise))(function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},d=function(e,t){var r,n,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},h=function(){function e(e,t,r,n,s){this.params=e,this.format=t,this.timeoutSec=r,this.datasource=n,this.backendSrv=s,this.offset=0,this.maximumOffset=1e4,this.messageCount=0,this.recordCount=0}return e.$inject=["params","format","timeoutSec","datasource","backendSrv"],e.prototype.getResult=function(){return l(this,void 0,void 0,function(){var e,t,r,n,o,i,a,u,c;return d(this,function(l){switch(l.label){case 0:return e=this.format.slice(0,-1),"time_series_records"===this.format&&(e="record"),["record","message"].includes(e)?[4,this.delay(1e3*Math.random())]:[2,Promise.reject({message:"unsupported type"})];case 1:l.sent(),t=0,l.label=2;case 2:if(!(t<6))return[3,9];l.label=3;case 3:return l.trys.push([3,5,,6]),[4,this.doRequest("POST","/v1/search/jobs",this.params)];case 4:return r=l.sent(),[3,6];case 5:return l.sent(),[3,6];case 6:return r.data&&r.data.id?[3,9]:[4,this.delay(this.calculateRetryWait(1e3,t))];case 7:return l.sent(),[3,8];case 8:return t++,[3,2];case 9:if(6===t)throw{job_id:r.data.id,message:"max retries exceeded"};t=0,l.label=10;case 10:if(!(t<6))return[3,20];l.label=11;case 11:return l.trys.push([11,15,,19]),n=this,[4,this.doRequest("GET","/v1/search/jobs/"+r.data.id)];case 12:return n.status=l.sent(),"DONE GATHERING RESULTS"===this.status.data.state?[3,14]:[4,this.delay(this.calculateRetryWait(1e3,t))];case 13:return l.sent(),[3,19];case 14:if(!(s.a.isEmpty(this.status.data.pendingErrors)&&s.a.isEmpty(this.status.data.pendingWarnings)||(o="",s.a.isEmpty(this.status.data.pendingErrors)||(o+="Error:\n"+this.status.data.pendingErrors.join("\n")+"\n"),s.a.isEmpty(this.status.data.pendingWarnings)||(o+="Warning:\n"+this.status.data.pendingWarnings.join("\n")),console.error(o),"Messages may have been omitted from your results due to a regex that performs poorly against your data."===this.status.data.pendingWarnings[0])))throw{job_id:r.data.id,message:o};return[3,20];case 15:return(i=l.sent()).data&&i.data.code&&"searchjob.jobid.invalid"===i.data.code?[4,this.delay(this.calculateRetryWait(1e3,t))]:[3,17];case 16:return l.sent(),[3,19];case 17:return this.doRequest("DELETE","/v1/search/jobs/"+r.data.id),[2,Promise.reject(i)];case 18:return[3,19];case 19:return t++,[3,10];case 20:if(6===t)throw this.doRequest("DELETE","/v1/search/jobs/"+r.data.id),{job_id:r.data.id,message:"max retries exceeded"};a={},t=0,l.label=21;case 21:if(!(t<6))return[3,26];l.label=22;case 22:return l.trys.push([22,24,,25]),0===this.status.data[e+"Count"]?[3,26]:0===(u=Math.min(this.maximumOffset,this.status.data[e+"Count"])-this.offset)?[3,26]:[4,this.doRequest("GET","/v1/search/jobs/"+r.data.id+"/"+e+"s?offset="+this.offset+"&limit="+u)];case 23:return c=l.sent(),this.offset+=c.data[e+"s"].length,a.data?a.data.records?a.data.records=(a.data.records||[]).concat(c.data.records):a.data.messages&&(a.data.messages=(a.data.messages||[]).concat(c.data.messages)):a=c,this.offset>=Math.min(this.maximumOffset,this.status.data[e+"Count"])?[3,26]:[3,25];case 24:return l.sent(),[3,25];case 25:return t++,[3,21];case 26:if(6===t)throw this.doRequest("DELETE","/v1/search/jobs/"+r.data.id),{job_id:r.data.id,message:"max retries exceeded"};try{this.doRequest("DELETE","/v1/search/jobs/"+r.data.id)}catch(e){}return[2,a.data]}})})},e.prototype.getResultObservable=function(){var e=this,t=new Date;return new c.Observable(function(r){l(e,void 0,void 0,function(){var e,n,o,i,a,u,l,h,p,f,m,b;return d(this,function(d){switch(d.label){case 0:if(e=this.format.slice(0,-1),"time_series_records"===this.format&&(e="record"),!["record","message"].includes(e))throw{message:"unsupported type"};return[4,this.delay(1e3*Math.random())];case 1:d.sent(),n=0,d.label=2;case 2:if(!(n<6))return[3,9];d.label=3;case 3:return d.trys.push([3,5,,6]),[4,this.doRequest("POST","/v1/search/jobs",this.params)];case 4:return o=d.sent(),[3,6];case 5:return d.sent(),[3,6];case 6:return o.data&&o.data.id?[3,9]:[4,this.delay(this.calculateRetryWait(1e3,n))];case 7:return d.sent(),[3,8];case 8:return n++,[3,2];case 9:if(6===n)throw{job_id:o.data.id,message:"max retries exceeded"};d.label=10;case 10:if((new Date).valueOf()-t.valueOf()>1e3*this.timeoutSec)throw console.error("timeout"),this.doRequest("DELETE","/v1/search/jobs/"+o.data.id),{job_id:o.data.id,message:"timeout"};i=void 0,i=0,d.label=11;case 11:if(!(i<6))return[3,20];d.label=12;case 12:return d.trys.push([12,15,,19]),a=this,[4,this.doRequest("GET","/v1/search/jobs/"+o.data.id)];case 13:if(a.status=d.sent(),u=this.messageCount,l=this.recordCount,this.messageCount=this.status.data.messageCount,this.recordCount=this.status.data.recordCount,!(s.a.isEmpty(this.status.data.pendingErrors)&&s.a.isEmpty(this.status.data.pendingWarnings)||(h="",s.a.isEmpty(this.status.data.pendingErrors)||(h+="Error:\n"+this.status.data.pendingErrors.join("\n")+"\n"),s.a.isEmpty(this.status.data.pendingWarnings)||(h+="Warning:\n"+this.status.data.pendingWarnings.join("\n")),console.error(h),"Messages may have been omitted from your results due to a regex that performs poorly against your data."===this.status.data.pendingWarnings[0])))throw{job_id:o.data.id,message:h};return"DONE GATHERING RESULTS"===this.status.data.state?[3,20]:("time_series_records"===this.format||"records"===this.format)&&this.recordCount>l?[3,20]:"messages"===this.format&&this.messageCount>u?[3,20]:[4,this.delay(this.calculateRetryWait(1e3,i))];case 14:return d.sent(),[3,19];case 15:return(p=d.sent()).data&&p.data.code&&"searchjob.jobid.invalid"===p.data.code?[4,this.delay(this.calculateRetryWait(1e3,i))]:[3,17];case 16:return d.sent(),[3,19];case 17:throw this.doRequest("DELETE","/v1/search/jobs/"+o.data.id),console.error(p),p;case 18:return[3,19];case 19:return i++,[3,11];case 20:if(6===i)throw this.doRequest("DELETE","/v1/search/jobs/"+o.data.id),{job_id:o.data.id,message:"max retries exceeded"};i=0,d.label=21;case 21:if(!(i<6))return[3,29];if(0==(f=Math.min(this.maximumOffset,this.status.data[e+"Count"])-this.offset))return[2,c.EMPTY];d.label=22;case 22:return d.trys.push([22,24,,28]),[4,this.doRequest("GET","/v1/search/jobs/"+o.data.id+"/"+e+"s?offset="+this.offset+"&limit="+f)];case 23:if(m=d.sent(),this.offset+=m.data[e+"s"].length,this.offset>=Math.min(this.maximumOffset,this.status.data[e+"Count"])){try{this.doRequest("DELETE","/v1/search/jobs/"+o.data.id)}catch(e){}return m.data.done=!0,[2,r.next(m.data)]}return r.next(m.data),[3,29];case 24:return(b=d.sent()).data&&b.data.code&&"searchjob.jobid.invalid"===b.data.code?[4,this.delay(this.calculateRetryWait(1e3,i))]:[3,26];case 25:return d.sent(),[3,28];case 26:throw this.doRequest("DELETE","/v1/search/jobs/"+o.data.id),console.error(b),b;case 27:return[3,28];case 28:return i++,[3,21];case 29:if(6===i)throw this.doRequest("DELETE","/v1/search/jobs/"+o.data.id),{job_id:o.data.id,message:"max retries exceeded"};return[3,10];case 30:return[2]}})})})},e.prototype.doRequest=function(e,t,r){return void 0===r&&(r={}),l(this,void 0,void 0,function(){var n,s,o,i=this;return d(this,function(a){switch(a.label){case 0:return 0!==this.datasource.token?[3,2]:[4,this.delay(Math.ceil(1e3/this.datasource.MAX_AVAILABLE_TOKEN))];case 1:return a.sent(),[2,this.doRequest(e,t,r)];case 2:n={method:e,url:this.datasource.url+t,data:r,headers:{},inspect:{type:"sumologic"},withCredentials:!1},(this.datasource.basicAuth||this.datasource.withCredentials)&&(n.withCredentials=!0),this.datasource.basicAuth&&(n.headers.Authorization=this.datasource.basicAuth),n.headers["Content-Type"]="application/json",this.datasource.token--,null===this.datasource.tokenTimer&&(this.datasource.tokenTimer=setInterval(function(){i.datasource.provideToken()},Math.ceil(1e3/this.datasource.MAX_AVAILABLE_TOKEN))),a.label=3;case 3:return a.trys.push([3,5,,9]),[4,this.backendSrv.datasourceRequest(n)];case 4:return(s=a.sent()).data.status&&404===s.data.status?[2,Promise.reject(s)]:[2,s];case 5:return(o=a.sent()).data&&o.data.code&&"rate.limit.exceeded"===o.data.code?(this.datasource.token=0,[4,this.retryable(3,function(e){return l(i,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return[4,this.delay(this.calculateRetryWait(1e3,e))];case 1:return t.sent(),[2,this.backendSrv.datasourceRequest(n)]}})})}).catch(function(e){return console.error("rate limit exceeded"),e})]):[3,7];case 6:return[2,a.sent()];case 7:return o.data&&o.data.code&&"searchjob.jobid.invalid"===o.data.code?[2,Promise.reject(o)]:(console.error(o),[2,Promise.reject(o)]);case 8:return[3,9];case 9:return[2]}})})},e.prototype.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},e.prototype.retryable=function(e,t){return l(this,void 0,void 0,function(){var r,n;return d(this,function(s){for(r=Promise.reject({}).catch(function(){return t(e)}),n=0;n<e;n++)!function(e){r=r.catch(function(r){return t(e+1)})}(n);return[2,r]})})},e.prototype.calculateRetryWait=function(e,t){return e*Math.min(10,Math.pow(2,t))+Math.floor(1e3*Math.random())},e}(),p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function f(e,t){function r(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function m(e){return"function"==typeof e}var b=!1,y={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;b=e},get useDeprecatedSynchronousErrorHandling(){return b}};function g(e){setTimeout(function(){throw e},0)}var v={closed:!0,next:function(e){},error:function(e){if(y.useDeprecatedSynchronousErrorHandling)throw e;g(e)},complete:function(){}},_=Array.isArray||function(e){return e&&"number"==typeof e.length};function x(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}x.prototype=Object.create(Error.prototype);var E=x,w=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r,n=this._parentOrParents,s=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var i=0;i<n.length;++i){n[i].remove(this)}if(m(s))try{s.call(this)}catch(e){t=e instanceof E?S(e.errors):[e]}if(_(o)){i=-1;for(var a=o.length;++i<a;){var u=o[i];if(null!==(r=u)&&"object"==typeof r)try{u.unsubscribe()}catch(e){t=t||[],e instanceof E?t=t.concat(S(e.errors)):t.push(e)}}}if(t)throw new E(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;(r=new e)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var s=r._parentOrParents;if(null===s)r._parentOrParents=this;else if(s instanceof e){if(s===this)return r;r._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return r;s.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[r]:o.push(r),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function S(e){return e.reduce(function(e,t){return e.concat(t instanceof E?t.errors:t)},[])}var T="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),j=function(e){function t(r,n,s){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=v;break;case 1:if(!r){o.destination=v;break}if("object"==typeof r){r instanceof t?(o.syncErrorThrowable=r.syncErrorThrowable,o.destination=r,r.add(o)):(o.syncErrorThrowable=!0,o.destination=new k(o,r));break}default:o.syncErrorThrowable=!0,o.destination=new k(o,r,n,s)}return o}return f(t,e),t.prototype[T]=function(){return this},t.create=function(e,r,n){var s=new t(e,r,n);return s.syncErrorThrowable=!1,s},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(w),k=function(e){function t(t,r,n,s){var o,i=e.call(this)||this;i._parentSubscriber=t;var a=i;return m(r)?o=r:r&&(o=r.next,n=r.error,s=r.complete,r!==v&&(m((a=Object.create(r)).unsubscribe)&&i.add(a.unsubscribe.bind(a)),a.unsubscribe=i.unsubscribe.bind(i))),i._context=a,i._next=o,i._error=n,i._complete=s,i}return f(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;y.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,r=y.useDeprecatedSynchronousErrorHandling;if(this._error)r&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)r?(t.syncErrorValue=e,t.syncErrorThrown=!0):g(e),this.unsubscribe();else{if(this.unsubscribe(),r)throw e;g(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};y.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),y.useDeprecatedSynchronousErrorHandling)throw e;g(e)}},t.prototype.__tryOrSetError=function(e,t,r){if(!y.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(t){return y.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(g(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(j);var O=function(){function e(e,t,r){void 0===r&&(r=!1),this.accumulator=e,this.seed=t,this.hasSeed=r}return e.prototype.call=function(e,t){return t.subscribe(new R(e,this.accumulator,this.seed,this.hasSeed))},e}(),R=function(e){function t(t,r,n,s){var o=e.call(this,t)||this;return o.accumulator=r,o._seed=n,o.hasSeed=s,o.index=0,o}return f(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,r=this.index++;try{t=this.accumulator(this.seed,e,r)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(j);var q,C=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new A(e,this.project,this.thisArg))},e}(),A=function(e){function t(t,r,n){var s=e.call(this,t)||this;return s.project=r,s.count=0,s.thisArg=n||s,s}return f(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(j),D=r(2),P=r(1),L=(q=function(e,t){return(q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),M=function(e,t,r,n){return new(r||(r=Promise))(function(s,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(i,a)}u((n=n.apply(e,t||[])).next())})},I=function(e,t){var r,n,s,o,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=(s=i.trys).length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],n=0}finally{r=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},F=function(e){function t(t,r,n,s,o){var i=e.call(this,t)||this;return i.type=t.type,i.name=t.name,i.url=t.url,i.basicAuth=t.basicAuth,i.withCredentials=t.withCredentials,i.timeoutSec=t.jsonData.timeout||180,i.$q=r,i.backendSrv=n,i.templateSrv=s,i.timeSrv=o,i.fieldIndex={tagKeys:new Set,tagValues:{}},i.MAX_AVAILABLE_TOKEN=4,i.token=i.MAX_AVAILABLE_TOKEN,i.tokenTimer=null,i.excludeFieldList=["_raw","_collectorid","_sourceid","_messageid","_messagecount","_messagetime","_receipttime","_size","_timeslice","processing_time_ms"],i}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","timeSrv"],L(t,e),t.prototype.provideToken=function(){this.token<this.MAX_AVAILABLE_TOKEN&&(this.token+=1,this.token===this.MAX_AVAILABLE_TOKEN&&(clearInterval(this.tokenTimer),this.tokenTimer=null))},t.prototype.query=function(e,t){var r=this,n=this;return e.targets.filter(function(e){return!e.hide&&!!e.query}).map(function(s){var o,i,a={query:r.templateSrv.replace(r.stripComment(s.query),e.scopedVars),from:r.convertTime(e.range.from,!1),to:r.convertTime(e.range.to,!0),timeZone:"Etc/UTC"},u=r.templateSrv.getAdhocFilters(r.name);if(u.length>0){var c=" | where "+u.map(function(e){switch(e.operator){case"=~":return e.key+' matches "'+e.value+'"';case"!~":return"!("+e.key+' matches "'+e.value+'")';default:return e.key+" "+e.operator+' "'+e.value+'"'}}).join(" and ");-1===a.query.indexOf("|")?a.query+=c:a.query=a.query.replace(/\|/,c+" |")}return r.logQueryObservable(a,s.format).pipe(function(e,t){var r=!1;return arguments.length>=2&&(r=!0),function(n){return n.lift(new O(e,t,r))}}(function(e,t){return e.fields=t.fields,t.records?e.records=(e.records||[]).concat(t.records):t.messages&&(e.messages=(e.messages||[]).concat(t.messages)),e.done=!!t.done,e},{}),(o=function(t){return r.hasAdhocFilter()&&(r.fieldIndex={tagKeys:new Set,tagValues:{}},t.fields.map(function(e){return e.name}).filter(function(e){return!r.excludeFieldList.includes(e)}).forEach(function(e){r.fieldIndex.tagKeys.add(e)}),(t.records||t.messages).forEach(function(e){Object.keys(e.map).filter(function(e){return!r.excludeFieldList.includes(e)}).forEach(function(t){r.fieldIndex.tagValues[t]||(r.fieldIndex.tagValues[t]=new Set),r.fieldIndex.tagValues[t].add(e.map[t])})})),"records"===s.format||"messages"===s.format?{key:"sumologic-"+s.refId,state:t.done?P.LoadingState.Loading:P.LoadingState.Done,request:e,data:[n.transformDataToTable(t)],unsubscribe:function(){}}:{key:"sumologic-"+s.refId,state:t.done?P.LoadingState.Loading:P.LoadingState.Done,request:e,data:"time_series_records"===s.format?n.transformRecordsToTimeSeries(t,s,e.intervalMs,e.range.to.valueOf()):t,unsubscribe:function(){}}},function(e){if("function"!=typeof o)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return e.lift(new C(o,i))})).subscribe({next:function(e){return t(e)}})}),this.$q.when({data:[]})},t.prototype.metricFindQuery=function(e){return M(this,void 0,void 0,function(){var t,r,n,o,i,a;return I(this,function(u){switch(u.label){case 0:return t=this.timeSrv.timeRange(),(r=e.match(/^record_values\(([^,]+?),\s?([^\)]+?)\)/))?(n=r[1].toLowerCase(),o=r[2],i={query:this.templateSrv.replace(this.stripComment(o)),from:String(this.convertTime(t.from,!1)),to:String(this.convertTime(t.to,!0)),timeZone:"Etc/UTC"},[4,this.logQuery(i,"records")]):[3,2];case 1:return a=u.sent(),s.a.isEmpty(a)?[2,[]]:[2,a.records.map(function(e){return{text:e.map[n],value:e.map[n]}})];case 2:return[2]}})})},t.prototype.annotationQuery=function(e){return M(this,void 0,void 0,function(){var t,r,n,o,i,a,u,c=this;return I(this,function(l){switch(l.label){case 0:return t=e.annotation,r=t.query||"",n=(n=t.tagKeys||"").split(","),o=t.titleFormat||"",i=t.textFormat||"",r?(a={query:this.templateSrv.replace(this.stripComment(r)),from:String(this.convertTime(e.range.from,!1)),to:String(this.convertTime(e.range.to,!0)),timeZone:"Etc/UTC"},[4,this.logQuery(a,"messages")]):[2,Promise.resolve([])];case 1:return u=l.sent(),s.a.isEmpty(u)?[2,[]]:[2,u.messages.map(function(e){var r=s.a.chain(e.map).filter(function(e,t){return s.a.includes(n,t)}).value();return{annotation:t,time:parseInt(e.map._messagetime,10),title:c.renderTemplate(o,e.map),tags:r,text:c.renderTemplate(i,e.map)}})]}})})},t.prototype.testDatasource=function(){return M(this,void 0,void 0,function(){var e;return I(this,function(t){switch(t.label){case 0:e={query:"| count _sourceCategory",from:(new Date).getTime()-6e5,to:(new Date).getTime(),timeZone:"Etc/UTC"},t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.logQuery(e,"records")];case 2:return t.sent(),[2,{status:"success",message:"Data source is working",title:"Success"}];case 3:return t.sent(),[2,{status:"error",message:"Data source is not working",title:"Error"}];case 4:return[2]}})})},t.prototype.logQuery=function(e,t){return M(this,void 0,void 0,function(){return I(this,function(r){switch(r.label){case 0:return[4,new h(e,t,this.timeoutSec,this,this.backendSrv).getResult()];case 1:return[2,r.sent()]}})})},t.prototype.logQueryObservable=function(e,t){return new h(e,t,this.timeoutSec,this,this.backendSrv).getResultObservable()},t.prototype.transformDataToTable=function(e){var t=new u.a,r=e.records?"records":"messages",n=s.a.uniq(s.a.map(e.fields,"name"));t.columns=n.map(function(e){return{text:e,filterable:!0}});for(var o=0,i=e[r];o<i.length;o++){for(var a=i[o],c=[],l=0,d=n;l<d.length;l++){var h=d[l];c.push(a.map[h]||"")}t.rows.push(c)}return Object(P.toDataFrame)(t)},t.prototype.transformRecordsToTimeSeries=function(e,t,r,n){var o=this,i="",a=[],u=e.fields,c=e.records;if(0===c.length)return Object(P.toDataFrame)({target:i,datapoints:a});var l=u.find(function(e){return"string"!==e.fieldType&&e.keyField});l=l?l.name:"";var d=[];u.forEach(function(e){"string"===e.fieldType||e.keyField||d.push(e.name)});var h=[];return 0===d.length?Object(P.toDataFrame)({target:i,datapoints:a}):(c=c.sort(function(e,t){return""===l?0:e.map[l]<t.map[l]?-1:e.map[l]>t.map[l]?1:0}),d.forEach(function(e){var a={};c.forEach(function(u){i=o.createMetricLabel(s.a.extend(u.map,{field:e}),t),a[i]=a[i]||[];var c=parseFloat(u.map[l]||n),d=a[i].length;d>0&&c-a[i][d-1][1]>r&&a[i].push([null,a[i][d-1][1]+r]),a[i].push([parseFloat(u.map[e]),c])}),s.a.each(a,function(e,t){h.push(Object(P.toDataFrame)({target:t,datapoints:e}))})}),h)},t.prototype.createMetricLabel=function(e,t){return s.a.isUndefined(t)||s.a.isEmpty(t.aliasFormat)?"":this.renderTemplate(this.templateSrv.replace(t.aliasFormat),e)||"{}"},t.prototype.renderTemplate=function(e,t){return e.replace(/\{\{\s*(.+?)\s*\}\}/g,function(e,r){return t[r]?t[r]:r})},t.prototype.stripComment=function(e){return e.split("\n").map(function(e){return e.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")}).filter(function(e){return""!==e}).join("\n")},t.prototype.convertTime=function(e,t){return s.a.isString(e)&&(e=i.a.parse(e,t)),e.valueOf()},t.prototype.hasAdhocFilter=function(){return s.a.some(this.templateSrv.variables,function(e){return"adhoc"===e.type})},t.prototype.getTagKeys=function(e){void 0===e&&(e={});var t=Array.from(this.fieldIndex.tagKeys).map(function(e){return{text:e}});return Promise.resolve(t)},t.prototype.getTagValues=function(e){void 0===e&&(e={});var t=Array.from(this.fieldIndex.tagValues[e.key]).map(function(e){return{text:e}});return Promise.resolve(t)},t}(D.DataSourceApi),H=r(4),$=r.n(H);$.a.module("grafana.directives").directive("sumologicQueryParameter",function(){return{templateUrl:"public/plugins/mtanda-sumologic-datasource/partials/query.parameter.html",controller:"SumologicQueryParameterCtrl",restrict:"E",scope:{target:"=",datasource:"=",panelType:"=",isLastQuery:"=",onChange:"&"}}}),$.a.module("grafana.controllers").controller("SumologicQueryParameterCtrl",["$scope",function(e){e.init=function(){var t=e.target;t.query=t.query||"",t.aliasFormat=t.aliasFormat||"",this.formats=[{text:"Time series (Records)",value:"time_series_records"},{text:"Records",value:"records"},{text:"Messages",value:"messages"}],s.a.includes(s.a.map(this.formats,"value"),t.format)||(t.format=e.getDefaultFormat()),e.onChange||(e.onChange=function(){})},e.getDefaultFormat=function(){return"table"===e.panelType?"records":"time_series_records"},e.init()}]);var N=r(7),U=(r(8),r(9),function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()),V=function(e){function t(t,r){return e.call(this,t,r)||this}return t.$inject=["$scope","$injector"],U(t,e),t.templateUrl="partials/query.editor.html",t}(N.QueryCtrl),W=function(){function e(e,t){this.scope=e}return e.$inject=["$scope","$injector"],e.templateUrl="partials/annotations.editor.html",e}(),Q=function(){function e(e){this.current.jsonData.timeout=this.current.jsonData.timeout||30}return e.$inject=["$scope"],e.templateUrl="public/plugins/mtanda-sumologic-datasource/partials/config.html",e}();r.d(t,"plugin",function(){return K});var K=new D.DataSourcePlugin(F).setConfigCtrl(Q).setQueryCtrl(V).setAnnotationQueryCtrl(W)}])});
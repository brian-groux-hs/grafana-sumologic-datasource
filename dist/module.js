define(["lodash","rxjs","angular","app/core/utils/datemath","app/core/table_model","app/plugins/sdk"],function(e,t,r,a,s,n){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var s=t[a]={i:a,l:!1,exports:{}};return e[a].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(a,s,function(t){return e[t]}.bind(null,s));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=8)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=s},function(e,t){e.exports=n},function(e,t){ace.define("ace/mode/sumologic_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],function(e,t,r){"use strict";var a=e("../lib/oop"),s=e("./text_highlight_rules").TextHighlightRules,n=function(){var e=this.createKeywordMapper({"support.function":"abs|accum|acos|asin|atan|atan2|avg|backshift|cbrt|ceil|concat|cos|cosh|count|count_distinct|count_frequent|diff|exp|expm1|fields|fillmissing|filter|first|last|floor|format|formatDate|lookup|hypot|if|ipv4ToNumber|isNull|isEmpty|isBlank|join|length|limit|log|log10|log1p|luhn|num|number|toLong|pct|merge|max|min|most_recent|least_recent|now|outlier|csv|split|json|keyvalue|kv|xml|parseDate|parseHex|pct_sampling|predict|queryEndTime|queryStartTime|queryTimeRange|replace|rollingstd|round|save|sessionize|sin|sinh|smooth|sort|sqrt|stddev|substring|sum|tan|tanh|timeslice|toDegrees|toLowerCase|toUpperCase|top|toRadians|total|trace|transaction|transpose|urldecode|where|getCIDRPrefix|compareCIDRPrefix|maskFromCIDRlogreduce|details|compare|logcompare",keyword:"as|by|from|in|matches|nodrop|on|regex|with_collector|_index|_source|_sourceCategory|_sourceHost|_sourceName|_view","constant.language":"true|false"},"identifier",!0);this.$rules={start:[{token:"string",regex:/"(?:[^"\\]|\\.)*?"/},{token:"string",regex:"'.*?'"},{token:"constant.numeric",regex:"[-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language",regex:"\\d+[smh]"},{token:"constant.language",regex:"\\d+[kKMGBTP]"},{token:e,regex:"[a-zA-Z]+"},{token:"keyword.operator",regex:"\\+|\\-|\\*|\\/|%|=|==|!=|<=|>=|<>|<|>"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}]},this.normalizeRules()};a.inherits(n,s),t.SumologicHighlightRules=n}),ace.define("ace/mode/sumologic_completions",["require","exports","module","ace/token_iterator","ace/lib/lang"],function(e,t,r){"use strict";var a=e("../lib/lang"),s=["_collector","_index","_source","_sourceCategory","_sourceHost","_sourceName","_view","as","by","from","in","on","matches","regex","nodrop","with","abs","accum","acos","asin","atan","atan2","avg","backshift","cbrt","ceil","concat","cos","cosh","count","count_distinct","count_frequent","diff","exp","expm1","fields","fillmissing","filter","first","last","floor","format","formatDate","lookup","hypot","if","ipv4ToNumber","isNull","isEmpty","isBlank","join","length","limit","log","log10","log1p","luhn","num","number","toLong","pct","merge","max","min","most_recent","least_recent","now","outlier","csv","split","json","keyvalue","kv","xml","parseDate","parseHex","pct_sampling","predict","queryEndTime","queryStartTime","queryTimeRange","replace","rollingstd","round","save","sessionize","sin","sinh","smooth","sort","sqrt","stddev","substring","sum","tan","tanh","timeslice","toDegrees","toLowerCase","toUpperCase","top","toRadians","total","trace","transaction","transpose","urldecode","where","getCIDRPrefix","compareCIDRPrefix","maskFromCIDR","logreduce","details","compare","logcompare"].map(function(e){return{caption:e,value:e,meta:"keyword",score:Number.MAX_VALUE}});function n(e){var t=a.escapeHTML(e.docText);return t=function(e,t){for(var r=[],a=0,s=0,n=t=t||60,o="",i=0;i<e.length;i++)" "===e[i]?a=i:i>=n&&0!=a&&(o=e.slice(s,a),r.push(o),s=a+1,n=i+t,a=0);return o=e.slice(s),r.push(o),r.join("&nbsp<br>")}(t,40).replace(/```(.+)```/,"<pre>$1</pre>").replace(/`([^`]+)`/,"<code>$1</code>"),["<b>",a.escapeHTML(e.def),"</b>","<hr></hr>",t,"<br>&nbsp"].join("")}var o=[].map(function(e){return{caption:e.name,value:e.value,docHTML:n(e),meta:"function",score:Number.MAX_VALUE}}),i=function(){};(function(){this.getCompletions=function(e,t,r,a,n){n(null,s.concat(o))}}).call(i.prototype),t.SumologicCompletions=i}),ace.define("ace/mode/behaviour/sumologic",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/mode/behaviour/cstyle","ace/token_iterator"],function(e,t,r){"use strict";var a=e("../../lib/oop"),s=(e("../behaviour").Behaviour,e("./cstyle").CstyleBehaviour),n=(e("../../token_iterator").TokenIterator,function(){this.inherit(s)});a.inherits(n,s),t.SumologicBehaviour=n}),ace.define("ace/mode/sumologic",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/sumologic_highlight_rules"],function(e,t,r){"use strict";var a=e("../lib/oop"),s=e("./text").Mode,n=e("./sumologic_highlight_rules").SumologicHighlightRules,o=e("./sumologic_completions").SumologicCompletions,i=e("./behaviour/sumologic").SumologicBehaviour,u=function(){this.HighlightRules=n,this.$behaviour=new i,this.$completer=new o,this.completer=this.$completer};a.inherits(u,s),function(){this.$id="ace/mode/sumologic"}.call(u.prototype),t.Mode=u})},function(e,t){ace.define("ace/snippets/sumologic",["require","exports","module"],function(e,t,r){"use strict";t.snippets=[],t.scope="sumologic"})},function(e,t,r){"use strict";r.r(t);var a=r(0),s=r.n(a),n=r(3),o=r.n(n),i=r(4),u=r.n(i),c=r(1),l=function(e,t,r,a){return new(r||(r=Promise))(function(s,n){function o(e){try{u(a.next(e))}catch(e){n(e)}}function i(e){try{u(a.throw(e))}catch(e){n(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,i)}u((a=a.apply(e,t||[])).next())})},d=function(e,t){var r,a,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function i(n){return function(i){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,i])}}},h=function(){function e(e,t,r,a,s){this.params=e,this.format=t,this.timeoutSec=r,this.datasource=a,this.backendSrv=s,this.offset=0,this.maximumOffset=1e4,this.messageCount=0,this.recordCount=0}return e.$inject=["params","format","timeoutSec","datasource","backendSrv"],e.prototype.getResult=function(){return l(this,void 0,void 0,function(){var e,t,r,a,n,o,i,u,c;return d(this,function(l){switch(l.label){case 0:return e=this.format.slice(0,-1),"time_series_records"===this.format&&(e="record"),["record","message"].includes(e)?[4,this.delay(1e3*Math.random())]:[2,Promise.reject({message:"unsupported type"})];case 1:l.sent(),t=0,l.label=2;case 2:if(!(t<6))return[3,9];l.label=3;case 3:return l.trys.push([3,5,,6]),[4,this.doRequest("POST","/v1/search/jobs",this.params)];case 4:return r=l.sent(),[3,6];case 5:return l.sent(),[3,6];case 6:return r.data&&r.data.id?[3,9]:[4,this.delay(this.calculateRetryWait(1e3,t))];case 7:return l.sent(),[3,8];case 8:return t++,[3,2];case 9:if(6===t)throw{job_id:r.data.id,message:"max retries exceeded"};t=0,l.label=10;case 10:if(!(t<6))return[3,20];l.label=11;case 11:return l.trys.push([11,15,,19]),a=this,[4,this.doRequest("GET","/v1/search/jobs/"+r.data.id)];case 12:return a.status=l.sent(),"DONE GATHERING RESULTS"===this.status.data.state?[3,14]:[4,this.delay(this.calculateRetryWait(1e3,t))];case 13:return l.sent(),[3,19];case 14:if(!(s.a.isEmpty(this.status.data.pendingErrors)&&s.a.isEmpty(this.status.data.pendingWarnings)||(n="",s.a.isEmpty(this.status.data.pendingErrors)||(n+="Error:\n"+this.status.data.pendingErrors.join("\n")+"\n"),s.a.isEmpty(this.status.data.pendingWarnings)||(n+="Warning:\n"+this.status.data.pendingWarnings.join("\n")),console.error(n),"Messages may have been omitted from your results due to a regex that performs poorly against your data."===this.status.data.pendingWarnings[0])))throw{job_id:r.data.id,message:n};return[3,20];case 15:return(o=l.sent()).data&&o.data.code&&"searchjob.jobid.invalid"===o.data.code?[4,this.delay(this.calculateRetryWait(1e3,t))]:[3,17];case 16:return l.sent(),[3,19];case 17:return this.doRequest("DELETE","/v1/search/jobs/"+r.data.id),[2,Promise.reject(o)];case 18:return[3,19];case 19:return t++,[3,10];case 20:if(6===t)throw this.doRequest("DELETE","/v1/search/jobs/"+r.data.id),{job_id:r.data.id,message:"max retries exceeded"};i={},t=0,l.label=21;case 21:if(!(t<6))return[3,26];l.label=22;case 22:return l.trys.push([22,24,,25]),0===this.status.data[e+"Count"]?[3,26]:0===(u=Math.min(this.maximumOffset,this.status.data[e+"Count"])-this.offset)?[3,26]:[4,this.doRequest("GET","/v1/search/jobs/"+r.data.id+"/"+e+"s?offset="+this.offset+"&limit="+u)];case 23:return c=l.sent(),this.offset+=c.data[e+"s"].length,i.data?i.data.records?i.data.records=(i.data.records||[]).concat(c.data.records):i.data.messages&&(i.data.messages=(i.data.messages||[]).concat(c.data.messages)):i=c,this.offset>=Math.min(this.maximumOffset,this.status.data[e+"Count"])?[3,26]:[3,25];case 24:return l.sent(),[3,25];case 25:return t++,[3,21];case 26:if(6===t)throw this.doRequest("DELETE","/v1/search/jobs/"+r.data.id),{job_id:r.data.id,message:"max retries exceeded"};try{this.doRequest("DELETE","/v1/search/jobs/"+r.data.id)}catch(e){}return[2,i.data]}})})},e.prototype.getResultObservable=function(){var e=this,t=new Date;return new c.Observable(function(r){l(e,void 0,void 0,function(){var e,a,n,o,i,u,l,h,m,f,p,g;return d(this,function(d){switch(d.label){case 0:if(e=this.format.slice(0,-1),"time_series_records"===this.format&&(e="record"),!["record","message"].includes(e))throw{message:"unsupported type"};return[4,this.delay(1e3*Math.random())];case 1:d.sent(),a=0,d.label=2;case 2:if(!(a<6))return[3,9];d.label=3;case 3:return d.trys.push([3,5,,6]),[4,this.doRequest("POST","/v1/search/jobs",this.params)];case 4:return n=d.sent(),[3,6];case 5:return d.sent(),[3,6];case 6:return n.data&&n.data.id?[3,9]:[4,this.delay(this.calculateRetryWait(1e3,a))];case 7:return d.sent(),[3,8];case 8:return a++,[3,2];case 9:if(6===a)throw{job_id:n.data.id,message:"max retries exceeded"};d.label=10;case 10:if((new Date).valueOf()-t.valueOf()>1e3*this.timeoutSec)throw console.error("timeout"),this.doRequest("DELETE","/v1/search/jobs/"+n.data.id),{job_id:n.data.id,message:"timeout"};o=void 0,o=0,d.label=11;case 11:if(!(o<6))return[3,20];d.label=12;case 12:return d.trys.push([12,15,,19]),i=this,[4,this.doRequest("GET","/v1/search/jobs/"+n.data.id)];case 13:if(i.status=d.sent(),u=this.messageCount,l=this.recordCount,this.messageCount=this.status.data.messageCount,this.recordCount=this.status.data.recordCount,!(s.a.isEmpty(this.status.data.pendingErrors)&&s.a.isEmpty(this.status.data.pendingWarnings)||(h="",s.a.isEmpty(this.status.data.pendingErrors)||(h+="Error:\n"+this.status.data.pendingErrors.join("\n")+"\n"),s.a.isEmpty(this.status.data.pendingWarnings)||(h+="Warning:\n"+this.status.data.pendingWarnings.join("\n")),console.error(h),"Messages may have been omitted from your results due to a regex that performs poorly against your data."===this.status.data.pendingWarnings[0])))throw{job_id:n.data.id,message:h};return"DONE GATHERING RESULTS"===this.status.data.state?[3,20]:("time_series_records"===this.format||"records"===this.format)&&this.recordCount>l?[3,20]:"messages"===this.format&&this.messageCount>u?[3,20]:[4,this.delay(this.calculateRetryWait(1e3,o))];case 14:return d.sent(),[3,19];case 15:return(m=d.sent()).data&&m.data.code&&"searchjob.jobid.invalid"===m.data.code?[4,this.delay(this.calculateRetryWait(1e3,o))]:[3,17];case 16:return d.sent(),[3,19];case 17:throw this.doRequest("DELETE","/v1/search/jobs/"+n.data.id),console.error(m),m;case 18:return[3,19];case 19:return o++,[3,11];case 20:if(6===o)throw this.doRequest("DELETE","/v1/search/jobs/"+n.data.id),{job_id:n.data.id,message:"max retries exceeded"};o=0,d.label=21;case 21:if(!(o<6))return[3,29];if(0==(f=Math.min(this.maximumOffset,this.status.data[e+"Count"])-this.offset))return[2,c.Observable.empty()];d.label=22;case 22:return d.trys.push([22,24,,28]),[4,this.doRequest("GET","/v1/search/jobs/"+n.data.id+"/"+e+"s?offset="+this.offset+"&limit="+f)];case 23:if(p=d.sent(),this.offset+=p.data[e+"s"].length,this.offset>=Math.min(this.maximumOffset,this.status.data[e+"Count"])){try{this.doRequest("DELETE","/v1/search/jobs/"+n.data.id)}catch(e){}return[2,r.next(p.data)]}return r.next(p.data),[3,29];case 24:return(g=d.sent()).data&&g.data.code&&"searchjob.jobid.invalid"===g.data.code?[4,this.delay(this.calculateRetryWait(1e3,o))]:[3,26];case 25:return d.sent(),[3,28];case 26:throw this.doRequest("DELETE","/v1/search/jobs/"+n.data.id),console.error(g),g;case 27:return[3,28];case 28:return o++,[3,21];case 29:if(6===o)throw this.doRequest("DELETE","/v1/search/jobs/"+n.data.id),{job_id:n.data.id,message:"max retries exceeded"};return[3,10];case 30:return[2]}})})})},e.prototype.doRequest=function(e,t,r){return void 0===r&&(r={}),l(this,void 0,void 0,function(){var a,s,n,o=this;return d(this,function(i){switch(i.label){case 0:return 0!==this.datasource.token?[3,2]:[4,this.delay(Math.ceil(1e3/this.datasource.MAX_AVAILABLE_TOKEN))];case 1:return i.sent(),[2,this.doRequest(e,t,r)];case 2:a={method:e,url:this.datasource.url+t,data:r,headers:{},inspect:{type:"sumologic"},withCredentials:!1},(this.datasource.basicAuth||this.datasource.withCredentials)&&(a.withCredentials=!0),this.datasource.basicAuth&&(a.headers.Authorization=this.datasource.basicAuth),a.headers["Content-Type"]="application/json",this.datasource.token--,null===this.datasource.tokenTimer&&(this.datasource.tokenTimer=setInterval(function(){o.datasource.provideToken()},Math.ceil(1e3/this.datasource.MAX_AVAILABLE_TOKEN))),i.label=3;case 3:return i.trys.push([3,5,,9]),[4,this.backendSrv.datasourceRequest(a)];case 4:return(s=i.sent()).data.status&&404===s.data.status?[2,Promise.reject(s)]:[2,s];case 5:return(n=i.sent()).data&&n.data.code&&"rate.limit.exceeded"===n.data.code?(this.datasource.token=0,[4,this.retryable(3,function(e){return l(o,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return[4,this.delay(this.calculateRetryWait(1e3,e))];case 1:return t.sent(),[2,this.backendSrv.datasourceRequest(a)]}})})}).catch(function(e){return console.error("rate limit exceeded"),e})]):[3,7];case 6:return[2,i.sent()];case 7:return n.data&&n.data.code&&"searchjob.jobid.invalid"===n.data.code?[2,Promise.reject(n)]:(console.error(n),[2,Promise.reject(n)]);case 8:return[3,9];case 9:return[2]}})})},e.prototype.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},e.prototype.retryable=function(e,t){return l(this,void 0,void 0,function(){var r,a;return d(this,function(s){for(r=Promise.reject({}).catch(function(){return t(e)}),a=0;a<e;a++)!function(e){r=r.catch(function(r){return t(e+1)})}(a);return[2,r]})})},e.prototype.calculateRetryWait=function(e,t){return e*Math.min(10,Math.pow(2,t))+Math.floor(1e3*Math.random())},e}(),m=function(e,t,r,a){return new(r||(r=Promise))(function(s,n){function o(e){try{u(a.next(e))}catch(e){n(e)}}function i(e){try{u(a.throw(e))}catch(e){n(e)}}function u(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(o,i)}u((a=a.apply(e,t||[])).next())})},f=function(e,t){var r,a,s,n,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function i(n){return function(i){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,a&&(s=2&n[0]?a.return:n[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){o.label=n[1];break}if(6===n[0]&&o.label<s[1]){o.label=s[1],s=n;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(n);break}s[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,i])}}},p=function(){function e(e,t,r,a,s){this.type=e.type,this.name=e.name,this.url=e.url,this.basicAuth=e.basicAuth,this.withCredentials=e.withCredentials,this.timeoutSec=e.jsonData.timeout||180,this.$q=t,this.backendSrv=r,this.templateSrv=a,this.timeSrv=s,this.fieldIndex={tagKeys:new Set,tagValues:{}},this.MAX_AVAILABLE_TOKEN=4,this.token=this.MAX_AVAILABLE_TOKEN,this.tokenTimer=null,this.excludeFieldList=["_raw","_collectorid","_sourceid","_messageid","_messagecount","_messagetime","_receipttime","_size","_timeslice","processing_time_ms"]}return e.$inject=["instanceSettings","$q","backendSrv","templateSrv","timeSrv"],e.prototype.provideToken=function(){this.token<this.MAX_AVAILABLE_TOKEN&&(this.token+=1,this.token===this.MAX_AVAILABLE_TOKEN&&(clearInterval(this.tokenTimer),this.tokenTimer=null))},e.prototype.query=function(e){var t=this,r=this,a=s.a.chain(e.targets).filter(function(e){return!e.hide&&e.query}).map(function(r){var a={query:t.templateSrv.replace(t.stripComment(r.query),e.scopedVars),from:t.convertTime(e.range.from,!1),to:t.convertTime(e.range.to,!0),timeZone:"Etc/UTC"},s=t.templateSrv.getAdhocFilters(t.name);if(s.length>0){var n=" | where "+s.map(function(e){switch(e.operator){case"=~":return e.key+' matches "'+e.value+'"';case"!~":return"!("+e.key+' matches "'+e.value+'")';default:return e.key+" "+e.operator+' "'+e.value+'"'}}).join(" and ");-1===a.query.indexOf("|")?a.query+=n:a.query=a.query.replace(/\|/,n+" |")}return t.logQueryObservable(a,r.format).scan(function(e,t){return e.fields=t.fields,t.records?e.records=(e.records||[]).concat(t.records):t.messages&&(e.messages=(e.messages||[]).concat(t.messages)),e},{})}).value();return c.Observable.combineLatest(a).map(function(a){a=a.filter(function(e){return!s.a.isEmpty(e)}),t.hasAdhocFilter()&&(t.fieldIndex={tagKeys:new Set,tagValues:{}},a.forEach(function(e){e.fields.map(function(e){return e.name}).filter(function(e){return!t.excludeFieldList.includes(e)}).forEach(function(e){t.fieldIndex.tagKeys.add(e)})}),a.forEach(function(e){(e.records||e.messages).forEach(function(e){Object.keys(e.map).filter(function(e){return!t.excludeFieldList.includes(e)}).forEach(function(r){t.fieldIndex.tagValues[r]||(t.fieldIndex.tagValues[r]=new Set),t.fieldIndex.tagValues[r].add(e.map[r])})})}));var n=s.a.chain(a).filter(function(t,r){return"records"===e.targets[r].format||"messages"===e.targets[r].format}).flatten().value();return n.length>0?{data:[r.transformDataToTable(n)],range:e.range}:{data:s.a.flatten(a.map(function(t,a){return"time_series_records"===e.targets[a].format?r.transformRecordsToTimeSeries(t,e.targets[a],e.intervalMs,e.range.to.valueOf()):t})),range:e.range}})},e.prototype.metricFindQuery=function(e){return m(this,void 0,void 0,function(){var t,r,a,n,o,i;return f(this,function(u){switch(u.label){case 0:return t=this.timeSrv.timeRange(),(r=e.match(/^record_values\(([^,]+?),\s?([^\)]+?)\)/))?(a=r[1].toLowerCase(),n=r[2],o={query:this.templateSrv.replace(this.stripComment(n)),from:String(this.convertTime(t.from,!1)),to:String(this.convertTime(t.to,!0)),timeZone:"Etc/UTC"},[4,this.logQuery(o,"records")]):[3,2];case 1:return i=u.sent(),s.a.isEmpty(i)?[2,[]]:[2,i.records.map(function(e){return{text:e.map[a],value:e.map[a]}})];case 2:return[2]}})})},e.prototype.annotationQuery=function(e){return m(this,void 0,void 0,function(){var t,r,a,n,o,i,u,c=this;return f(this,function(l){switch(l.label){case 0:return t=e.annotation,r=t.query||"",a=(a=t.tagKeys||"").split(","),n=t.titleFormat||"",o=t.textFormat||"",r?(i={query:this.templateSrv.replace(this.stripComment(r)),from:String(this.convertTime(e.range.from,!1)),to:String(this.convertTime(e.range.to,!0)),timeZone:"Etc/UTC"},[4,this.logQuery(i,"messages")]):[2,Promise.resolve([])];case 1:return u=l.sent(),s.a.isEmpty(u)?[2,[]]:[2,u.messages.map(function(e){var r=s.a.chain(e.map).filter(function(e,t){return s.a.includes(a,t)}).value();return{annotation:t,time:parseInt(e.map._messagetime,10),title:c.renderTemplate(n,e.map),tags:r,text:c.renderTemplate(o,e.map)}})]}})})},e.prototype.testDatasource=function(){return m(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:e={query:"| count _sourceCategory",from:(new Date).getTime()-6e5,to:(new Date).getTime(),timeZone:"Etc/UTC"},t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.logQuery(e,"records")];case 2:return t.sent(),[2,{status:"success",message:"Data source is working",title:"Success"}];case 3:return t.sent(),[2,{status:"error",message:"Data source is not working",title:"Error"}];case 4:return[2]}})})},e.prototype.logQuery=function(e,t){return m(this,void 0,void 0,function(){return f(this,function(r){switch(r.label){case 0:return[4,new h(e,t,this.timeoutSec,this,this.backendSrv).getResult()];case 1:return[2,r.sent()]}})})},e.prototype.logQueryObservable=function(e,t){return new h(e,t,this.timeoutSec,this,this.backendSrv).getResultObservable()},e.prototype.transformDataToTable=function(e){var t=new u.a;if(0===e.length)return t;var r=e[0].records?"records":"messages",a=s.a.chain(e).map(function(e){return s.a.map(e.fields,"name")}).flatten().uniq().value();return t.columns=a.map(function(e){return{text:e,filterable:!0}}),e.forEach(function(e){for(var s=0,n=e[r];s<n.length;s++){for(var o=n[s],i=[],u=0,c=a;u<c.length;u++){var l=c[u];i.push(o.map[l]||"")}t.rows.push(i)}}),t},e.prototype.transformRecordsToTimeSeries=function(e,t,r,a){var n=this,o="",i=[],u=e.fields,c=e.records;if(0===c.length)return{target:o,datapoints:i};var l=u.find(function(e){return"string"!==e.fieldType&&e.keyField});l=l?l.name:"";var d=[];u.forEach(function(e){"string"===e.fieldType||e.keyField||d.push(e.name)});var h=[];return 0===d.length?{target:o,datapoints:i}:(c=c.sort(function(e,t){return""===l?0:e.map[l]<t.map[l]?-1:e.map[l]>t.map[l]?1:0}),d.forEach(function(e){var i={};c.forEach(function(u){o=n.createMetricLabel(s.a.extend(u.map,{field:e}),t),i[o]=i[o]||[];var c=parseFloat(u.map[l]||a),d=i[o].length;d>0&&c-i[o][d-1][1]>r&&i[o].push([null,i[o][d-1][1]+r]),i[o].push([parseFloat(u.map[e]),c])}),s.a.each(i,function(e,t){h.push({target:t,datapoints:e})})}),h)},e.prototype.createMetricLabel=function(e,t){return s.a.isUndefined(t)||s.a.isEmpty(t.aliasFormat)?"":this.renderTemplate(this.templateSrv.replace(t.aliasFormat),e)||"{}"},e.prototype.renderTemplate=function(e,t){return e.replace(/\{\{\s*(.+?)\s*\}\}/g,function(e,r){return t[r]?t[r]:r})},e.prototype.stripComment=function(e){return e.split("\n").map(function(e){return e.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")}).filter(function(e){return""!==e}).join("\n")},e.prototype.convertTime=function(e,t){return s.a.isString(e)&&(e=o.a.parse(e,t)),e.valueOf()},e.prototype.hasAdhocFilter=function(){return s.a.some(this.templateSrv.variables,function(e){return"adhoc"===e.type})},e.prototype.getTagKeys=function(e){return Promise.resolve(Array.from(this.fieldIndex.tagKeys).map(function(e){return{type:"key",text:e}}))},e.prototype.getTagValues=function(e){return Promise.resolve(Array.from(this.fieldIndex.tagValues[e.key]).map(function(e){return{type:"value",text:e}}))},e}(),g=r(2),y=r.n(g);y.a.module("grafana.directives").directive("sumologicQueryParameter",function(){return{templateUrl:"public/plugins/mtanda-sumologic-datasource/partials/query.parameter.html",controller:"SumologicQueryParameterCtrl",restrict:"E",scope:{target:"=",datasource:"=",panelType:"=",isLastQuery:"=",onChange:"&"}}}),y.a.module("grafana.controllers").controller("SumologicQueryParameterCtrl",["$scope",function(e){e.init=function(){var t=e.target;t.query=t.query||"",t.aliasFormat=t.aliasFormat||"",this.formats=[{text:"Time series (Records)",value:"time_series_records"},{text:"Records",value:"records"},{text:"Messages",value:"messages"}],s.a.includes(s.a.map(this.formats,"value"),t.format)||(t.format=e.getDefaultFormat()),e.onChange||(e.onChange=function(){})},e.getDefaultFormat=function(){return"table"===this.panelType?"records":"time_series_records"},e.init()}]);var v,b=r(5),x=(r(6),r(7),v=function(e,t){return(v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}v(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=function(e){function t(t,r){return e.call(this,t,r)||this}return t.$inject=["$scope","$injector"],x(t,e),t.templateUrl="partials/query.editor.html",t}(b.QueryCtrl),E=function(){function e(e,t){this.scope=e}return e.$inject=["$scope","$injector"],e.templateUrl="partials/annotations.editor.html",e}(),T=function(){function e(e){this.current.jsonData.timeout=this.current.jsonData.timeout||30}return e.$inject=["$scope"],e.templateUrl="public/plugins/mtanda-sumologic-datasource/partials/config.html",e}();r.d(t,"Datasource",function(){return p}),r.d(t,"ConfigCtrl",function(){return T}),r.d(t,"QueryCtrl",function(){return _}),r.d(t,"AnnotationsQueryCtrl",function(){return E})}])});